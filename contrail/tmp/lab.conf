#include "/vmm/bin/common.defs"
#include "/vmm/data/user_disks/vmxc/common.vmx.p3.defs"
#define CENTOSDISK  basedisk "/vmm/data/user_disks/irzan/centos300g.img";
#define VMX_DISK0  basedisk "/vmm/data/user_disks/irzan/vmx-19.3R1.8/junos-vmx-x86-64-19.3R1.8.vmdk";
#define VMX_DISK1  basedisk "/vmm/data/user_disks/irzan/vmx-19.3R1.8/vFPC-20190819.vmdk";
#define VQFX_RE  basedisk "/vmm/data/user_disks/irzan/vqfx/jinstall-vqfx-10-f-17.3R3-S2.2.vmdk";
#define VQFX_COSIM  basedisk "/vmm/data/user_disks/irzan/vqfx/cosim-2018-02-12.vmdk";
config "contrail"{
  bridge "lan1"{};
  bridge "sdngwg0"{};
  bridge "sdngwg1"{};
  bridge "mgmt"{};
  bridge "l1p2"{};
  bridge "l2p2"{};
  bridge "l2p4"{};
  bridge "l2p3"{};
  bridge "sdngwg4"{};
  bridge "sdngwg5"{};
  bridge "sdngwg2"{};
  bridge "sdngwg3"{};
  bridge "s1l1"{};
  bridge "s1l2"{};
  bridge "s2l1"{};
  bridge "s2l2"{};
  bridge "l1p3"{};
  bridge "reserved_bridge" {};
  bridge "spine1INT"{};
  bridge "spine2INT"{};
  bridge "leaf1INT"{};
  bridge "leaf2INT"{};
  PRIVATE_BRIDGES
vm "gw" {
   hostname "gw";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 2048;
   interface "em0" { bridge "external";};
   interface "em1" { bridge "lan1";};
   interface "em2" { bridge "sdngwg0";};
   interface "em3" { bridge "sdngwg1";};
   interface "em4" { bridge "mgmt";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.gw" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth1.gw" "/etc/sysconfig/network-scripts/ifcfg-eth1";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth2.gw" "/etc/sysconfig/network-scripts/ifcfg-eth2";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth3.gw" "/etc/sysconfig/network-scripts/ifcfg-eth3";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth4.gw" "/etc/sysconfig/network-scripts/ifcfg-eth4";
   install "/vmm/data/user_disks/irzan/contrail/01-ip_forward.conf" "/etc/sysctl.d/01-ip_forward.conf";
   install "/vmm/data/user_disks/irzan/contrail/rc.local.gw" "/etc/rc.d/rc.local";
};
vm "node0" {
   hostname "node0";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 4;
   memory 32768;
   interface "em0" { bridge "lan1";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.node0" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.node0" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "node1" {
   hostname "node1";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 4;
   memory 32768;
   interface "em0" { bridge "lan1";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.node1" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.node1" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "node2" {
   hostname "node2";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 4;
   memory 32768;
   interface "em0" { bridge "lan1";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.node2" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.node2" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "node3" {
   hostname "node3";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 2;
   memory 16384;
   interface "em0" { bridge "lan1";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.node3" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.node3" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "node4" {
   hostname "node4";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 4;
   memory 32768;
   interface "em0" { bridge "lan1";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.node4" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.node4" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "node5" {
   hostname "node5";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 2;
   memory 16384;
   interface "em0" { bridge "lan1";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.node5" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.node5" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "node6" {
   hostname "node6";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 2;
   memory 16384;
   interface "em0" { bridge "lan1";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.node6" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.node6" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "svr1" {
   hostname "svr1";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "l1p2";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.svr1" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.svr1" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "svr2" {
   hostname "svr2";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "l2p2";};
   interface "em2" { bridge "l2p4";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.svr2" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.svr2" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "svr3" {
   hostname "svr3";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "l2p3";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.svr3" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.svr3" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "ext1l2" {
   hostname "ext1l2";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "sdngwg4";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.ext1l2" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.ext1l2" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
vm "ext1l3" {
   hostname "ext1l3";
   CENTOSDISK
   setvar "+qemu_args" "-cpu qemu64,+vmx";
   ncpus 1;
   memory 4096;
   interface "em0" { bridge "mgmt";};
   interface "em1" { bridge "sdngwg5";};
   install "/vmm/data/user_disks/irzan/contrail/hostname.ext1l3" "/etc/hostname";
   install "/vmm/data/user_disks/irzan/contrail/ifcfg-eth0.ext1l3" "/etc/sysconfig/network-scripts/ifcfg-eth0";
   install "/vmm/data/user_disks/irzan/contrail/resolv.conf" "/etc/resolv.conf";
};
   
   #undef EM_IPADDR
   #define EM_IPADDR interface "em0" { bridge "mgmt";};
   #define VMX_CHASSIS_I2CID 21
   #define VMX_CHASSIS_NAME sdngw
   VMX_CHASSIS_START() 
      VMX_RE_START(sdngw_re,0)
         VMX_RE_INSTANCE(sdngw_re0, VMX_DISK0, VMX_RE_I2CID,0)
         install "/vmm/data/user_disks/irzan/contrail/sdngw.conf" "/root/junos.base.conf";
      VMX_RE_END
      VMX_MPC_START(sdngw_MP,0)
        VMX_MPC_INSTANCE(sdngw_MPC, VMX_DISK1, VMX_MPC_I2CID, 0)
            VMX_CONNECT(GE(0,0,0), sdngwg0)
            VMX_CONNECT(GE(0,0,1), sdngwg1)
            VMX_CONNECT(GE(0,0,2), sdngwg2)
            VMX_CONNECT(GE(0,0,3), sdngwg3)
            VMX_CONNECT(GE(0,0,4), sdngwg4)
            VMX_CONNECT(GE(0,0,5), sdngwg5)
      VMX_MPC_END
   VMX_CHASSIS_END
   #undef VMX_CHASSIS_I2CID
   #undef VMX_CHASSIS_NAME

   vm "spine1_re" {
      hostname "spine1_re";
      VQFX_RE
      setvar "boot_noveriexec" "YES";
      setvar "qemu_args" "-smbios type=1,product=QFX10K-11";
      install "/vmm/data/user_disks/irzan/contrail/spine1.conf" "/root/junos.base.conf";
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "spine1INT"; ipaddr "169.254.0.2"; };
      interface "em2" { bridge "reserved_bridge"; };
      interface "em3" { bridge "sdngwg2";};
      interface "em4" { bridge "s1l1";};
      interface "em5" { bridge "s1l2";};
   };
   vm "spine1_cosim" {
      hostname "spine1_cosim";
      VQFX_COSIM
      memory 4096;
      ncpus 2;
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "spine1INT"; ipaddr "169.254.0.1"; };
   };


   vm "spine2_re" {
      hostname "spine2_re";
      VQFX_RE
      setvar "boot_noveriexec" "YES";
      setvar "qemu_args" "-smbios type=1,product=QFX10K-11";
      install "/vmm/data/user_disks/irzan/contrail/spine2.conf" "/root/junos.base.conf";
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "spine2INT"; ipaddr "169.254.0.2"; };
      interface "em2" { bridge "reserved_bridge"; };
      interface "em3" { bridge "sdngwg3";};
      interface "em4" { bridge "s2l1";};
      interface "em5" { bridge "s2l2";};
   };
   vm "spine2_cosim" {
      hostname "spine2_cosim";
      VQFX_COSIM
      memory 4096;
      ncpus 2;
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "spine2INT"; ipaddr "169.254.0.1"; };
   };


   vm "leaf1_re" {
      hostname "leaf1_re";
      VQFX_RE
      setvar "boot_noveriexec" "YES";
      setvar "qemu_args" "-smbios type=1,product=QFX10K-11";
      install "/vmm/data/user_disks/irzan/contrail/leaf1.conf" "/root/junos.base.conf";
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "leaf1INT"; ipaddr "169.254.0.2"; };
      interface "em2" { bridge "reserved_bridge"; };
      interface "em3" { bridge "s1l1";};
      interface "em4" { bridge "s2l1";};
      interface "em5" { bridge "l1p2";};
      interface "em6" { bridge "l1p3";};
   };
   vm "leaf1_cosim" {
      hostname "leaf1_cosim";
      VQFX_COSIM
      memory 4096;
      ncpus 2;
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "leaf1INT"; ipaddr "169.254.0.1"; };
   };


   vm "leaf2_re" {
      hostname "leaf2_re";
      VQFX_RE
      setvar "boot_noveriexec" "YES";
      setvar "qemu_args" "-smbios type=1,product=QFX10K-11";
      install "/vmm/data/user_disks/irzan/contrail/leaf2.conf" "/root/junos.base.conf";
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "leaf2INT"; ipaddr "169.254.0.2"; };
      interface "em2" { bridge "reserved_bridge"; };
      interface "em3" { bridge "s1l2";};
      interface "em4" { bridge "s2l2";};
      interface "em5" { bridge "l2p2";};
      interface "em6" { bridge "l2p3";};
      interface "em7" { bridge "l2p4";};
   };
   vm "leaf2_cosim" {
      hostname "leaf2_cosim";
      VQFX_COSIM
      memory 4096;
      ncpus 2;
      interface "em0" { bridge "mgmt"; };
      interface "em1" { bridge "leaf2INT"; ipaddr "169.254.0.1"; };
   };

};
